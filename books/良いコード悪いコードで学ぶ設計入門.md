# 良いコード/悪いコードで学ぶ設計入門

## クラス設計

良いクラスの構成要素

- インスタンス変数
- インスタンス変数を不正状態から防御し、正常に操作するメソッド

インスタンス変数を変更する場合は新しいインスタンス変数を生成する

プリミティブ型ではなく値オブジェクトを受け渡すことで、値の受け渡しミスを防ぐ

他のクラスを操作するメソッドを作らない

## 低凝集

classにファクトリメソッドを入れて目的別初期化を行う  
ファクトリメソッドが増えたらファクトリクラスを検討する

## 条件分岐

if文の多重ネスト  
→早期returnする,else句は書かない

条件分岐は一か所にまとめる

switchを使いたいケース  
→interfaceを使って分岐ロジックをなくす
→ストラテジパターン

ストラテジの切り替えはenum型をkeyにしたmapで実装する

policyパターンはネストが深い場合に使える

フラグ引数はダメ  
→メソッドを分離してストラテジパターンで切り替える

## コレクション

コレクション（配列、リスト）はクラスにしてしまう

操作をメソッドとして実装

外部へ渡す場合は変更不可にする

## 蜜結合

なんでもpublicにしない

大量のインスタンス変数をもつ巨大データクラスは蜜結合の温床  
→グローバル変数と同じ性質

単一責任原則を遵守したクラスはだいたい100行程度、多くても200行程度

## 設計の健全性を損なう悪魔たち

nullは返さない、渡さない  
→クラスとしてEMPTY状態を定義して、それを渡す

## 名前設計

存在ベースの大雑把な物の名前ではなく、関心事に沿った目的ベースの具体的な名前をつける

可能な限り具体的で意味範囲が狭い、特化した名前

~info, ~dataといった名前には気を付ける

動詞＋目的語のメソッド名は注意  
→動詞単体のメソッド名になるようにクラスを作る

## メソッド

引数

- 引数は不変
- フラグ引数は使わない
- nullを渡さない
- 引数は可能な限り少なく

## モデリング

システム＝目的達成手段

モデル＝特定の目的達成のために最低限考慮が必要な要素を備えたもの

良くないモデル

- 複数の目的のために利用されている

モデルは目的別に複数定義する

モデルを物として解釈するとうまくいかない  
→目的達成手段として定義する

単一責任とは単一目的で達成できる


## 設計の意義と設計への向き合い方

人間の短期記憶における認識可能なチャンク数は4±1を前提にする

マジックナンバー４

